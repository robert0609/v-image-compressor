!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("babel-polyfill")):"function"==typeof define&&define.amd?define(["babel-polyfill"],t):"object"==typeof exports?exports.vImageCompressor=t(require("babel-polyfill")):e.vImageCompressor=t(e[void 0])}("undefined"!=typeof self?self:this,function(e){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist/",t(t.s=0)}([function(e,t,r){"use strict";function n(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,a){try{var o=t[i](a),u=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}return n("next")})}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.imageList,r=void 0===t?[]:t,n=e.ratio,i=void 0===n?.8:n,a=e.disableFixOrientation,o=void 0!==a&&a,u=Array.from(r).map(function(e){return new y(e,i,o).handle()});return Promise.all(u)}function o(e){return new Promise(function(t,r){if(e.src)if(/^data\:/i.test(e.src)){var n=u(e.src);t(n)}else if(/^blob\:/i.test(e.src)){var i=new FileReader;i.onload=function(e){t(e.target.result)},s(e.src,function(e){i.readAsArrayBuffer(e)})}else{var a=new XMLHttpRequest;a.onload=function(){200==this.status||0===this.status?t(a.response):r(new Error("Could not load image!")),a=null},a.onerror=function(e){r(new Error("Load image error!"))},a.open("GET",e.src,!0),a.responseType="arraybuffer",a.send(null)}else r(new Error("image src is null!"))})}function u(e,t){t=t||e.match(/^data\:([^\;]+)\;base64,/im)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var r=atob(e),n=r.length,i=new ArrayBuffer(n),a=new Uint8Array(i),o=0;o<n;o++)a[o]=r.charCodeAt(o);return i}function s(e,t){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="blob",r.onload=function(e){200!=this.status&&0!==this.status||t(this.response)},r.send()}Object.defineProperty(t,"__esModule",{value:!0});var c=r(1),l=(r.n(c),r(2)),f=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),d=Symbol("image"),h=Symbol("ratio"),g=Symbol("blob"),m=Symbol("disableFixOrientation"),v=Symbol("readImagePromise"),p=Symbol("readExifInfoPromise"),b=Symbol("canvasTransformPromise"),y=function(){function e(t,r,n){i(this,e),this[d]=t,this[g]=null,this[h]=r,this[m]=n}return f(e,[{key:"handle",value:function(){function e(){return t.apply(this,arguments)}var t=n(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this[v]();case 2:return e.next=4,this[p]();case 4:return t=e.sent,e.next=7,this[b](t);case 7:return r=e.sent,e.abrupt("return",r);case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:v,value:function(){var e=this;return new Promise(function(t,r){if(e[d]instanceof File){e[g]=e[d];var n=new FileReader;n.onload=function(r){var n=document.createElement("img");n.onload=function(){e[d]=n,t()},n.src=r.target.result},n.readAsDataURL(e[d])}else e[d]instanceof HTMLImageElement?o(e[d]).then(function(r){e[g]=r,t()}).catch(function(e){t()}):r(new Error("image which to be compressed is error type!"))})}},{key:p,value:function(){var t=this;return new Promise(function(r,n){var i=function(n){n<1&&(n=1);var i=t[d].width,a=t[d].height,o=0,u=0,s=1;if(5===n||6===n||7===n||8===n){var c=e.getScaledSize(a,i);o=c.width,u=c.height,s=u/i}else{var l=e.getScaledSize(i,a);o=l.width,u=l.height,s=o/i}r({originalWidth:i,originalHeight:a,scaledWidth:o,scaledHeight:u,scaledRatio:s,orientation:n})};!t[m]&&t[g]?Object(l.a)(t[g],i):i(1)})}},{key:b,value:function(e){var t=this,r=e.originalWidth,n=e.originalHeight,i=e.scaledWidth,a=e.scaledHeight,o=e.scaledRatio,u=e.orientation;return new Promise(function(e){var s=document.createElement("canvas");s.width=i,s.height=a;var c=s.getContext("2d");c.scale(o,o),3===u||4===u?(c.rotate(Math.PI),c.translate(0-r,0-n)):5===u||6===u?(c.rotate(Math.PI/2),c.translate(0,0-n)):7!==u&&8!==u||(c.rotate(0-Math.PI/2),c.translate(0-r,0)),c.drawImage(t[d],0,0),e({resultImageData:s.toDataURL("image/jpeg",t[h])})})}}],[{key:"getScaledSize",value:function(e,t){if(e>1024){var r=Math.round(1024/e*t);if(r>1024){return{width:Math.round(1024/t*e),height:1024}}return{width:1024,height:r}}if(t>1024){var n=Math.round(1024/t*e);if(n>1024){return{width:1024,height:Math.round(1024/e*t)}}return{width:n,height:1024}}return{width:e,height:t}}}]),e}();t.default={compress:a}},function(t,r){t.exports=e},function(e,t,r){"use strict";function n(e,t){try{var r=new window.FileReader;r.onload=function(e){try{var r=new window.DataView(e.target.result);if(65496!=r.getUint16(0,!1))return t(-2);for(var n=r.byteLength,i=2;i<n;){var a=r.getUint16(i,!1);if(i+=2,65505==a){if(1165519206!=r.getUint32(i+=2,!1))return t(-1);var o=18761==r.getUint16(i+=6,!1);i+=r.getUint32(i+4,o);var u=r.getUint16(i,o);i+=2;for(var s=0;s<u;s++)if(274==r.getUint16(i+12*s,o))return t(r.getUint16(i+12*s+8,o))}else{if(65280!=(65280&a))break;i+=r.getUint16(i,!1)}}return t(-1)}catch(e){t(-3,e)}},r.readAsArrayBuffer(e)}catch(e){t(-3,e)}}t.a=n}])});